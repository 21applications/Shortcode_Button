window.wp_sc_buttons=window.wp_sc_buttons||{},function(window,document,$,QTags,l10n,btns,undefined){"use strict";if(l10n){var $c={};btns.qt={},btns.log=function(){btns.log.history=btns.log.history||[],btns.log.history.push(arguments),window.console&&window.console.log(Array.prototype.slice.call(arguments))};var Button=function(params){var btn={params:params,isVisual:!1,$:{}},cached=!1;return btn.cache=function(){cached||(btn.$.wrap=$(document.getElementById(params.slug+"-form")),btn.$.form=btn.$.wrap.length?btn.$.wrap.find("form"):!1,cached=!0)},btn.close=function(){btn.$.form&&(btn.$.form.trigger("reset"),btn.$.form.find('[class^="cmb-row cmb-type-"]').trigger("shortcode_button:clear")),$(document).off("keyup",btn.keyup),$c.modal.off("click",".scb-insert",btn.insert),$c.wrap.removeClass("scbshow")},btn.insert=function(){var ajaxData={fields:btn.$.form?btn.$.form.serialize():{},action:"wp_sc_form_process_"+params.slug},formFail=function(response){btns.log("response failure",response),btns.log("ajaxurl",ajaxurl),btns.log("fields",ajaxData.fields),btns.log("buttonParams",params),btn.close()};$.post(ajaxurl,ajaxData,function(response){response.success?btn.insertCallback(response.data):formFail(response)}).fail(formFail)},btn.getSelectedText=function(){if(btn.isVisual&&window.tinymce.activeEditor)return window.tinymce.activeEditor.selection.getContent();if(btn.canvas.focus(),document.selection)return document.selection.createRange().text;var startPos=btn.canvas.selectionStart,endPos=btn.canvas.selectionEnd;return startPos!==endPos?btn.canvas.value.substring(startPos,endPos):""},btn.buildShortCode=function(shortcode_params){var shortcode="["+params.slug,selected_text=btn.getSelectedText(),content="";return $.each(shortcode_params,function(key,value){"sc_content"===key?content=value:shortcode+=" "+key+'="'+value+'"'}),shortcode+="]",(params.include_close||content)&&(shortcode=shortcode+selected_text+content+"[/"+params.slug+"]"),shortcode},btn.insertCallback=function(shortcode_params){var shortcodeToInsert=btn.buildShortCode(shortcode_params);shortcodeToInsert&&(btn.isVisual&&btns.visualmode[params.slug]?btns.visualmode[params.slug].execCommand("mceInsertContent",0,shortcodeToInsert):QTags.insertContent(shortcodeToInsert),$c.body.trigger("shortcode_button:insert",{btn:btn,inserted:shortcodeToInsert}),btn.close())},btn.initModal=function(){btn.$.wrap.length&&($c.modal.addClass(params.modalClass).css({height:params.modalHeight,width:params.modalWidth}),$c.modal.find(".scb-title").text(params.button_tooltip),$c.modal.find(".scb-cancel").text(params.l10ncancel),$c.modal.find(".scb-insert").text(params.l10ninsert))},btn.keyup=function(evt){13===evt.keyCode&&(evt.preventDefault(),btn.insert()),27===evt.keyCode&&btns.close()},btn.openModal=function(){btns.open(btn.$.wrap),$c.modal.find(".scb-insert").trigger("focus"),$c.modal.one("click",".scb-insert",btn.insert),$(document).on("keyup",btn.keyup)},btn.click=function(isVisual,canvas){return btn.cache(),btn.isVisual=!0===isVisual,btn.canvas=canvas||"",$c.body.trigger("shortcode_button:click",{btn:btn}),btn.$.wrap.length?(btn.initModal(),void btn.openModal()):btn.insert()},btn};!function(){for(var button,i=l10n.length-1;i>=0;i--)button=new Button(l10n[i]),QTags.addButton(button.params.slug,button.params.qt_button_text,button.click),btns.qt[button.params.slug]=button}(),btns.open=function(el){$c.body.trigger("shortcode_button:open",el)},btns.close=function(){$c.body.trigger("shortcode_button:close")},btns.clearFields=function(evt){var $this=$(evt.target),type=$this.attr("class").replace("cmb-row cmb-type-","").split(" ")[0];switch(type){case"file":case"file-list":return $this.find(".cmb2-media-status").html("");case"colorpicker":return $this.find(".wp-picker-clear").click()}},btns.init=function(){$c.body=$(document.body),$c.body.on("click","#scb-overlay, .scb-close, .scb-cancel",btns.close).on("shortcode_button:clear",btns.clearFields).on("shortcode_button:close",function(){$.each(btns.qt,function(slug,btn){btn.close()}),$c.wrap.removeClass("scbshow")}).on("shortcode_button:open",function(evt,el){$c.wrap.addClass("scbshow"),el&&($c.forms.removeClass("scbshow"),$(el).addClass("scbshow"));var width=$c.modal.outerWidth(),height=$c.modal.outerHeight(),css={};window.innerWidth>width&&(css.left=(window.innerWidth-width)/2),window.innerHeight>height&&(css.top=.15*window.innerHeight+window.scrollY),$c.modal.css(css)}),$c.wrap=$(document.getElementById("scb-wrap")),$c.modal=$(document.getElementById("scb-modal")),$c.forms=$(".scb-form-wrap")},$(btns.init)}}(window,document,jQuery,QTags,shortcodeButtonsl10n,wp_sc_buttons);