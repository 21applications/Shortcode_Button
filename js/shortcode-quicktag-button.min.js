window.wp_sc_buttons=window.wp_sc_buttons||{},window.wp_sc_buttons.qt=function(window,document,$,QTags,buttons,scbuttons,undefined){"use strict";if(buttons){scbuttons.log=function(){scbuttons.log.history=scbuttons.log.history||[],scbuttons.log.history.push(arguments),window.console&&window.console.log(Array.prototype.slice.call(arguments))};for(var Button=function(params){var btn={params:params,isVisual:!1,$:{}},cached=!1;return btn.cache=function(){cached||(btn.$.body=$(document.body),btn.$.modal=$(document.getElementById(params.slug+"-form")),btn.$.form=btn.$.modal.length?btn.$.modal.find("form"):!1,cached=!0)},btn.create=function(){var $this=$(this),$form=$this.parent(),$submitBtn=$form.find(".ui-dialog-buttonpane button:last-child");$submitBtn.focus().addClass("button-primary"),$this.on("keypress",function(evt){13===evt.keyCode&&(evt.preventDefault(),$submitBtn.click())})},btn.close=function(){btn.$.form&&btn.$.form.trigger("reset")},btn.cancel=function(){btn.$.modal.length&&btn.$.modal.dialog("close")},btn.insert=function(){var ajaxData={fields:btn.$.form?btn.$.form.serialize():{},action:"wp_sc_form_process_"+params.slug},formFail=function(response){scbuttons.log("response failure",response),scbuttons.log("ajaxurl",ajaxurl),scbuttons.log("fields",ajaxData.fields),scbuttons.log("buttonParams",params),btn.cancel()};$.post(ajaxurl,ajaxData,function(response){response.success?btn.insertCallback(response.data):formFail(response)}).fail(formFail)},btn.getSelectedText=function(){if(btn.isVisual&&window.tinymce.activeEditor)return window.tinymce.activeEditor.selection.getContent();if(btn.canvas.focus(),document.selection)return document.selection.createRange().text;var startPos=btn.canvas.selectionStart,endPos=btn.canvas.selectionEnd;return startPos!==endPos?btn.canvas.value.substring(startPos,endPos):""},btn.buildShortCode=function(shortcode_params){var shortcode="["+params.slug,selected_text=btn.getSelectedText(),content="";return $.each(shortcode_params,function(key,value){"sc_content"===key?content=value:shortcode+=" "+key+'="'+value+'"'}),shortcode+="]",(params.include_close||content)&&(shortcode=shortcode+selected_text+content+"[/"+params.slug+"]"),shortcode},btn.insertCallback=function(shortcode_params){var shortcodeToInsert=btn.buildShortCode(shortcode_params);shortcodeToInsert&&(btn.isVisual&&scbuttons.visualmode[params.slug]?scbuttons.visualmode[params.slug].execCommand("mceInsertContent",0,shortcodeToInsert):QTags.insertContent(shortcodeToInsert),btn.$.body.trigger("shortcode_button:insert",{btn:btn,inserted:shortcodeToInsert}),btn.cancel())},btn.init=function(){btn.cache();var buttons={};if(buttons[params.l10ncancel]=btn.cancel,buttons[params.l10ninsert]=btn.insert,btn.$.modal.length){var args={dialogClass:params.modalClass,modal:!0,autoOpen:!1,draggable:!1,height:params.modalHeight,width:params.modalWidth,closeOnEscape:!0,buttons:buttons,create:btn.create,close:btn.close};btn.$.modal.dialog(args)}},btn.click=function(isVisual,canvas){return btn.cache(),btn.isVisual=!0===isVisual,btn.canvas=canvas||"",btn.$.body.trigger("shortcode_button:click",{btn:btn}),btn.$.modal.length?btn.$.modal.dialog("open"):void btn.insert()},btn},qt={},i=buttons.length-1;i>=0;i--){var button=new Button(buttons[i]);button.init(),QTags.addButton(button.params.slug,button.params.qt_button_text,button.click),qt[button.params.slug]=button}return $(document.body).on("click",".ui-widget-overlay",function(){$.each(qt,function(slug,btn){btn.cancel()})}),qt}}(window,document,jQuery,QTags,shortcodeButtonsl10n,wp_sc_buttons);